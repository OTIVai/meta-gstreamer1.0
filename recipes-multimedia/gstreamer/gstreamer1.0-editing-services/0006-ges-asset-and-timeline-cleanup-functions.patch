From ee67b54dcce48b664b74d1f5d1bcd9c707dc7918 Mon Sep 17 00:00:00 2001
From: Bernd Geiser <bg@ferncast.de>
Date: Fri, 18 Aug 2023 13:36:38 +0200
Subject: [PATCH] ges asset and timeline: cleanup functions

---
 ges/ges-asset.c    | 25 +++++++++++++++++++++++++
 ges/ges-asset.h    |  2 ++
 ges/ges-internal.h |  4 ++--
 ges/ges-timeline.h |  2 ++
 4 files changed, 31 insertions(+), 2 deletions(-)

diff --git a/ges/ges-asset.c b/ges/ges-asset.c
index 503c5d2..6647b77 100644
--- a/ges/ges-asset.c
+++ b/ges/ges-asset.c
@@ -1668,3 +1668,28 @@ ges_asset_get_error (GESAsset * self)
 
   return self->priv->error;
 }
+
+
+gboolean
+ges_asset_forget (GESAsset * self)
+{
+  GType extractable_type;
+  GESAssetCacheEntry *entry;
+  gboolean res = FALSE;
+
+  extractable_type = self->priv->extractable_type;
+
+  LOCK_CACHE;
+  if ((entry = _lookup_entry (extractable_type, self->priv->id))) {
+    GHashTable *entries_table;
+
+    entries_table = g_hash_table_lookup (_get_type_entries (),
+        _extractable_type_name (extractable_type));
+    if (entries_table != NULL) {
+      res = g_hash_table_remove (entries_table, (gpointer)self->priv->id);
+    }
+  }
+  UNLOCK_CACHE;
+
+  return res;
+}
diff --git a/ges/ges-asset.h b/ges/ges-asset.h
index b2a23c2..d307663 100644
--- a/ges/ges-asset.h
+++ b/ges/ges-asset.h
@@ -142,5 +142,7 @@ GESAsset * ges_asset_get_proxy       (GESAsset *asset);
 GES_API
 gboolean ges_asset_needs_reload 	 (GType extractable_type,
 									  const gchar * id);
+GES_API
+gboolean ges_asset_forget                (GESAsset * self);
 
 G_END_DECLS
diff --git a/ges/ges-internal.h b/ges/ges-internal.h
index 445ca82..6a7c3d4 100644
--- a/ges/ges-internal.h
+++ b/ges/ges-internal.h
@@ -179,8 +179,8 @@ ges_timeline_set_moving_track_elements (GESTimeline * timeline, gboolean moving)
 G_GNUC_INTERNAL gboolean
 ges_timeline_add_clip (GESTimeline * timeline, GESClip * clip, GError ** error);
 
-G_GNUC_INTERNAL void
-ges_timeline_remove_clip (GESTimeline * timeline, GESClip * clip);
+/* G_GNUC_INTERNAL void */
+/* ges_timeline_remove_clip (GESTimeline * timeline, GESClip * clip); */
 
 G_GNUC_INTERNAL void
 ges_timeline_set_smart_rendering (GESTimeline * timeline, gboolean rendering_smartly);
diff --git a/ges/ges-timeline.h b/ges/ges-timeline.h
index 92cb496..5e80422 100644
--- a/ges/ges-timeline.h
+++ b/ges/ges-timeline.h
@@ -165,4 +165,6 @@ void ges_timeline_disable_edit_apis (GESTimeline * self, gboolean disable_edit_a
 GES_API
 gboolean ges_timeline_get_edit_apis_disabled (GESTimeline * self);
 
+GES_API void
+ges_timeline_remove_clip (GESTimeline * timeline, GESClip * clip);
 G_END_DECLS
-- 
2.39.2

